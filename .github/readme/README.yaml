module_name: Terraform RDS Module
module_description: The Terraform wrapper for RDS simplifies the configuration of the Relational Database Service in the AWS cloud. This wrapper functions as a predefined template, facilitating the creation and management of RDS instances by handling all the technical details.
quick_start: |
  ```hcl
  rds_parameters = {
    ## Nombre y definici√≥n de una instancia RDS
    "00" = {
      
      ## Definiciones para la creaci√≥n del motor
      engine                 = "mariadb"
      engine_version         = "10.6.14"
      instance_class         = "db.t3.micro"
      deletion_protection    = true
      publicly_accessible    = false
      
      ## Definici√≥n de subnets sobre las cuales se desplegar√° y acceder√° al motor
      ## Definido por ids
      subnet_ids             = data.aws_subnets.public.ids
      ## Definido por nombre
      # subnet_name = "${local.common_name_prefix}-db*" # Default: "${local.common_name_prefix}-private*"
      
      ## Reglas de acceso para el recurso
      ingress_with_cidr_blocks = [
        {
          rule        = "mysql-tcp"
          cidr_blocks = "172.1.0.0/16"
        }
      ]
      
      ## Definici√≥n de tama√±o y tipo de storage para el motor
      allocated_storage     = 5
      max_allocated_storage = 10
      storage_type          = null
      
      ## Parametros que utilizara el motor
      parameters = [
        {
          name  = "max_connections"
          value = "150"
        }
      ]
      ## Definiciones de ventanas de mantenimiento y backup
      maintenance_window      = "Sun:04:00-Sun:06:00"
      backup_window           = "03:00-03:30"
      backup_retention_period = "7"
      apply_immediately       = false
      
      ## Habilitaci√≥n y retenci√≥n de servicio de performance insights
      #performance_insights_enabled           = false
      #performance_insights_retention_period  = 7
    }
  }
  
  rds_defaults = var.rds_defaults
  ```
features:
  - icon: üîê
    title: User and Database Management
    short_description: Manages users, databases, and access with credential storage and notifications
    long_description: |
      Deploy lambda function, which manages the creation and modification of *Users*, *Databases*, and their access to them.
      The credentials for the accesses will be stored in a parameter of **Parameter Store**.
      Send notifications of the actions taken.
      Does not remove databases or users; the latter will remain without permissions on the resources.
    examples:
      - title: MySQL / MariaDB code
        code: |
          ```hcl
          rds_parameters = {
            "mysql" = {
              ...
              enable_db_management                    = true
              enable_db_management_logs_notifications = true
              db_management_parameters = {
                databases = [
                  {
                    name    = "mydb1"
                    charset = "utf8mb4"
                    collate = "utf8mb4_general_ci"
                  },
                  {
                    name    = "mydb2"
                    charset = "utf8mb4"
                    collate = "utf8mb4_general_ci"
                  }
                ],
                users = [
                  {
                    username = "user1"
                    host     = "%"
                    password = "password1"
                    grants = [
                      {
                        database   = "mydb1"
                        table      = "*"
                        privileges = "ALL"
                      },
                      {
                        database   = "mydb2"
                        table      = "*"
                        privileges = "SELECT, UPDATE"
                      }
                    ]
                  },
                  {
                    username = "user2"
                    host     = "%"
                    password = "password2"
                    grants = [
                      {
                        database   = "mydb2"
                        table      = "*"
                        privileges = "ALL"
                      }
                    ]
                  }
                ],
                excluded_users = ["rdsadmin", "root", "mariadb.sys", "healthcheck", "rds_superuser_role", "mysql.infoschema", "mysql.session", "mysql.sys"]
              }
              ...
            }
          }
          ```
      - title: PostgreSQL code
        code: |
          ```hcl
          rds_parameters = {
            "postgresql" = {
              ...
              enable_db_management                    = true
              enable_db_management_logs_notifications = true
              db_management_parameters = {
                databases = [
                  {
                    "name" : "db1",
                    "owner" : "root",
                    "schemas" : [
                      {
                        "name" : "public",
                        "owner" : "root"
                      },
                      {
                        "name" : "schema1",
                        "owner" : "usr1"
                      }
                    ]
                  },
                  {
                    "name" : "db2",
                    "owner" : "usr2",
                  },
                  {
                    "name" : "db3",
                    "owner" : "usr3",
                  }
                ],
                roles = [
                  { "rolename" : "example_role_1" },
                  { "rolename" : "example_role_2" }
                ],
                users = [
                  {
                    "username" : "usr1",
                    "password" : "passwd1",
                    "grants" : [
                      {
                        "database" : "db1",
                        "schema" : "public",
                        "privileges" : "ALL PRIVILEGES",
                        "table" : "*"
                      }
                    ]
                  },
                  {
                    "username" : "usr2",
                    "password" : "passwd2",
                    "grants" : [
                      {
                        "privileges" : "example_role_1",
                        "options" : "WITH SET TRUE"
                      },
                      {
                        "privileges" : "example_role_2",
                        "options" : "WITH SET TRUE"
                      }
                    ]
                  },
                  {
                    "username" : "usr3",
                    "password" : "passwd3",
                    "grants" : []
                  }
                ],
                excluded_users = ["rdsadmin", "root", "healthcheck"]
              }
              ...
            }
          }
          ```
  - icon: üíæ
    title: Dump with S3
    short_description: Creates SQL dump backups in S3 for MySQL, MariaDB, and PostgreSQL databases
    long_description: |
      This module creates the necessary resources to generate an SQL dump and store it in an S3 bucket, along with cleanup scripts for the database. <br/> It supports the database engines **MySQL**, **MariaDB**, and **PostgreSQL**.
    examples:
      - title: Configuration Code
        code: |
          ```hcl
          rds_parameters = {
            "00" = {
              ...
              enable_db_dump_create = true
              db_dump_create_local_path_custom_scripts = "${path.module}/content/custom_sql"
              db_dump_create_schedule_expression = "cron(0 * * * ? *)"
              db_dump_create_db_name = "demo"
              db_dump_create_retention_in_days = 7
              db_dump_create_s3_arn_permission_accounts = [
                "arn:aws:iam::xxxxxxxxxxx:root", # demo.la-dev
                "arn:aws:iam::xxxxxxxxxxx:root", # demo.la-stg
              ]
              ...
            }
          }
          ```
  - icon: üíæ
    title: Restore with S3
    short_description: Restores database from SQL dump and runs cleanup scripts
    long_description: |
      This module creates the necessary resources to perform a restore from an SQL dump stored in a bucket and execute the necessary cleanup scripts. <br/> It supports the database engines **MySQL**, **MariaDB**, and **PostgreSQL**
    examples:
      - title: Configuration Code
        code: |
          ```hcl
          enable_db_dump_restore = true
          db_dump_restore_s3_bucket_name = "demo-l04-core-00-db-dump-create"
          db_dump_restore_db_name = "demo"
          ```
  - icon: üîÑ
    title: DB Reset
    short_description: Deletes and recreates database, supporting MySQL, MariaDB, and PostgreSQL
    long_description: |
      This module deletes the database and recreates it, eliminating all data. It is intended to be used in development environments. <br/> It supports the database engines **MySQL**, **MariaDB**, and **PostgreSQL**.
    examples:
      - title: Configuration Code
        code: |
          ```hcl
          enable_db_reset = true
          ```
  - icon: üåê
    title: DNS Record
    short_description: Registers a CNAME DNS record in a Route53 hosted zone
    long_description: |
      Register a CNAME DNS record in a Route53 hosted zone that is present within the account, which can be public or private depending on the desired visibility type of the record.
    examples:
      - title: Configuration Code
        code: |
          ```hcl
          dns_records = {
            "" = {
              # zone_name    = local.zone_private
              # private_zone = true
              zone_name    = local.zone_public
              private_zone = false
            }
          }
          ```
  - icon: üï∞Ô∏è
    title: Enrollment of Point in Time Recovery
    short_description: Enables Point in Time Recovery backup policy integration
    long_description: |
      This tag allows the resource to be added to a backup policy of the Point in Time Recovery type. It requires having the policy deployed with AWS Backups and the tag to be used.
    examples:
      - title: Configuration Code
        code: |
          ```hcl
          tags = { ptr-14d = "true" }
          ```
important_notes: |
  - **üö® Restart Engine on Parameter Group Changes:** Automatically restart the engine when parameter group changes are applied.
  - **üö® Drop/Create Database:** Perform a drop and create operation on a database.
  - **‚ö†Ô∏è Expose Resource to Internet:** Ensure resource is publicly accessible to internet users.
  - **‚ö†Ô∏è Overwrite Database Data:** Allows overwriting data in a database.
  - **‚ÑπÔ∏è Unlimited Storage Growth Enabled:** Enables unlimited storage growth for the database instance.
input_table: |
  | engine | Motor de base de datos | String | "mariadb" | no |
  | engine_version | Version del motor deseada | String | "10.6.14" | no |
  | instance_class | Tama√±o del recurso | String | "db.t3.micro" | no |
  | deletion_protection | Protecci√≥n contra eliminaci√≥n del recurso | Boleano | true | no |
  | publicly_accessible | Habilita el acceso desde internet | Boleano | false | no |
  | subnet_ids | Listado de subnets sobre los cuales se despliega el recurso | Lista | [] | no |
  | subnet_name | Wildcard para encontrar las subnets en donde deployar motor y lambdas | String | `"${local.common_name_prefix}-private*"` | no |
  | ingress_with_cidr_blocks | Reglas de entrada para el recurso | Array de Objetos | `[{ rule = "mysql-tcp", cidr_blocks = "172.1.0.0/16" }]` | no |
  | allocated_storage | Almacenamiento m√≠nimo de la instancia | Entero | 5 | no |
  | max_allocated_storage | Almacenamiento m√°ximo de la instancia | Entero | 10 | no |
  | storage_type | Tipo de almacenamiento | string | null | yes |
  | parameters | Definici√≥n de par√°metros para Parameter Group | Array de Objetos | `[ {   name  = "max_connections, "value = "150" }    ]` | no |
  | maintenance_window | Horario de ventana de mantenimiento | String | "Sun:04:00-Sun:06:00" | no |
  | backup_window | Horario de ventana de Backup | String | "03:00-03:30" | no |
  | backup_retention_period | Retenci√≥n en dias de Backups | Entero | "7" | no |
  | apply_immediately | Aplica inmediatamente cambios que puedan reiniciar el motor | Boleano | false | no |
  | performance_insights_enabled | Habilitaci√≥n de feature de Performance Insights | Boleano | false | no |
  | performance_insights_retention_period | Retenci√≥n de informac√≥n de feature de Performance Insights | Entero | 7 | no |
  | username | El nombre de usuario maestro de la base de datos. | string | root | no |
  | password | La contrase√±a del usuario maestro generada por el recurso random password. | string | generada autom√°ticamente | no |
  | manage_master_user_password | Administra autom√°ticamente la rotaci√≥n de la contrase√±a del usuario maestro. | bool | false | no |
  | master_user_secret_kms_key_id | ID de la clave KMS para cifrar el secreto del usuario maestro. | string | null | yes |
  | manage_master_user_password_rotation | Activa la rotaci√≥n autom√°tica de la contrase√±a del usuario maestro. | bool | false | no |
  | master_user_password_rotate_immediately | Rota inmediatamente la contrase√±a del usuario maestro. | bool | null | yes |
  | master_user_password_rotation_automatically_after_days | N√∫mero de d√≠as tras los cuales se rota autom√°ticamente la contrase√±a. | number | null | yes |
  | master_user_password_rotation_duration | Duraci√≥n en d√≠as de la validez de la contrase√±a tras la rotaci√≥n. | number | null | yes |
  | master_user_password_rotation_schedule_expression | Expresi√≥n de programaci√≥n para la rotaci√≥n (ejemplo, cron). | string | null | yes |
  | create_db_subnet_group | Indica si se debe crear un grupo de subredes para la base de datos. | bool | true | no |
  | db_subnet_group_name | Nombre del grupo de subredes para la base de datos. | string | `${local.common_name}-${each.key}` | no |
  | db_subnet_group_use_name_prefix | Usa un prefijo de nombre para el grupo de subredes. | bool | false | no |
  | db_subnet_group_description | Descripci√≥n del grupo de subredes. | string | null | yes |
  | db_subnet_group_tags | Etiquetas asignadas al grupo de subredes. | map | {} | no |
  | create_db_parameter_group | Indica si se debe crear un grupo de par√°metros para la base de datos. | bool | true | no |
  | parameter_group_name | Nombre del grupo de par√°metros para la base de datos. | string | `${local.common_name}-${each.key}` | no |
  | parameter_group_use_name_prefix | Usa un prefijo de nombre para el grupo de par√°metros. | bool | false | no |
  | family | Familia de la base de datos para el grupo de par√°metros. | string | mariadb10.6 | no |
  | parameters | Lista de par√°metros del grupo de par√°metros. | list | [] | no |
  | parameter_group_description | Descripci√≥n del grupo de par√°metros. | string | null | yes |
  | db_parameter_group_tags | Etiquetas asignadas al grupo de par√°metros. | map | {} | no |
  | create_db_option_group | Indica si se debe crear un grupo de opciones para la base de datos. | bool | true | no |
  | option_group_name | Nombre del grupo de opciones para la base de datos. | string | `${local.common_name}-${each.key}` | no |
  | option_group_use_name_prefix | Usa un prefijo de nombre para el grupo de opciones. | bool | false | no |
  | major_engine_version | Versi√≥n principal del motor para el grupo de opciones. | string | 10.6 | no |
  | options | Lista de opciones del grupo de opciones. | list | [] | no |
  | option_group_description | Descripci√≥n del grupo de opciones. | string | null | yes |
  | option_group_timeouts | Timeouts para las operaciones del grupo de opciones. | map | {} | no |
  | db_option_group_tags | Etiquetas asignadas al grupo de opciones. | map | {} | no |
  | option_group_skip_destroy | Si debe evitarse la destrucci√≥n del grupo de opciones. | bool | null | yes |
  | create_db_instance | Indica si se debe crear la instancia de base de datos. | bool | true | no |
  | engine_lifecycle_support | Soporte de ciclo de vida del motor de la base de datos. | string | null | yes |
  | instance_class | Clase de instancia de la base de datos. | string | db.t3.micro | no |
  | port | Puerto para la conexi√≥n a la base de datos. | int | 3306 | no |
  | db_name | Nombre de la base de datos. | string | null | yes |
  | vpc_security_group_ids | Lista de IDs de grupos de seguridad del VPC. | list | `[module.security_group_rds]` | no |
  | network_type | Tipo de red para la base de datos. | string | null | yes |
  | availability_zone | Zona de disponibilidad para la base de datos. | string | null | yes |
  | multi_az | Habilitar multi-AZ para alta disponibilidad. | bool | false | no |
  | kms_key_id | ID de la clave KMS para cifrado de la base de datos. | string | null | yes |
  | ca_cert_identifier | Identificador del certificado CA para la base de datos. | string | null | yes |
  | publicly_accessible | Indica si la base de datos es p√∫blicamente accesible. | bool | false | no |
  | deletion_protection | Protecci√≥n contra la eliminaci√≥n de la base de datos. | bool | true | no |
  | timeouts | Configuraci√≥n de tiempos de espera para la base de datos. | map | {} | no |
  | snapshot_identifier | Identificador del snapshot para restaurar la base de datos. | string | null | yes |
  | db_instance_tags | Etiquetas asignadas a la instancia de base de datos. | map | {} | no |
  | custom_iam_instance_profile | Perfil de instancia IAM personalizado. | string | null | yes |
  | dedicated_log_volume | Indica si se debe crear un volumen dedicado para los logs de la base de datos. | bool | false | no |
  | allocated_storage | Almacenamiento asignado para la base de datos. | int | 5 | no |
  | max_allocated_storage | Almacenamiento m√°ximo asignado para la base de datos. | int | 10 | no |
  | storage_type | Tipo de almacenamiento (gp2, io1, etc.). | string | null | yes |
  | iops | N√∫mero de IOPS asignados para almacenamiento. | int | null | yes |
  | storage_throughput | Rendimiento de almacenamiento en MB/s. | int | null | yes |
  | storage_encrypted | Indica si el almacenamiento est√° cifrado. | bool | true | no |
  | upgrade_storage_config | Configuraci√≥n para actualizaci√≥n de almacenamiento. | string | null | yes |
  | iam_database_authentication_enabled | Habilitar autenticaci√≥n IAM para la base de datos. | bool | false | no |
  | domain | Dominio al que est√° asociado la base de datos. | string | null | yes |
  | domain_auth_secret_arn | ARN del secreto de autenticaci√≥n del dominio. | string | null | yes |
  | domain_dns_ips | IPs DNS asociadas al dominio. | list | null | yes |
  | domain_fqdn | FQDN (nombre de dominio completo) del dominio. | string | null | yes |
  | domain_iam_role_name | Nombre del rol IAM asociado al dominio. | string | null | yes |
  | domain_ou | Unidad organizativa (OU) del dominio. | string | null | yes |
  | delete_automated_backups | Indica si se deben eliminar los backups automatizados. | bool | true | no |
  | restore_to_point_in_time | Restaurar a un punto espec√≠fico en el tiempo. | string | null | yes |
  | final_snapshot_identifier_prefix | Prefijo para el identificador del snapshot final. | string | null | yes |
  | skip_final_snapshot | Saltar la creaci√≥n de snapshot final al eliminar la instancia. | bool | true | no |
  | copy_tags_to_snapshot | Copiar etiquetas al snapshot al crearlo. | bool | true | no |
  | maintenance_window | Ventana de mantenimiento para la instancia RDS. | string | "Sun:04:00-Sun:06:00" | no |
  | allow_major_version_upgrade | Permitir la actualizaci√≥n de versi√≥n mayor del motor de base de datos. | bool | false | no |
  | auto_minor_version_upgrade | Actualizaci√≥n autom√°tica de versiones menores. | bool | true | no |
  | apply_immediately | Aplicar los cambios inmediatamente, si es posible. | bool | false | no |
  | create_monitoring_role | Crear el rol de monitoreo para RDS. | bool | true | no |
  | monitoring_role_arn | ARN del rol de monitoreo existente. | string | null | yes |
  | monitoring_role_name | Nombre del rol de monitoreo. | string | `"${local.common_name}-rds-monitoring-${each.key}"` | no |
  | monitoring_role_use_name_prefix | Usar prefijo para el nombre del rol de monitoreo. | bool | false | no |
  | monitoring_role_description | Descripci√≥n del rol de monitoreo. | string | null | yes |
  | monitoring_interval | Intervalo de monitoreo en segundos. | int | 0 | no |
  | performance_insights_kms_key_id | KMS Key ID para Performance Insights. | string | null | yes |
  | create_cloudwatch_log_group | Crear grupo de logs en CloudWatch. | bool | false | no |
  | enabled_cloudwatch_logs_exports | Exportar logs a CloudWatch. | list | [] | no |
  | cloudwatch_log_group_retention_in_days | Retenci√≥n de logs en CloudWatch (d√≠as). | int | 7 | no |
  | cloudwatch_log_group_kms_key_id | KMS Key ID para el grupo de logs en CloudWatch. | string | null | yes |
  | monitoring_role_permissions_boundary | L√≠mite de permisos para el rol de monitoreo. | string | null | yes |
  | cloudwatch_log_group_skip_destroy | Omitir la destrucci√≥n del grupo de logs en CloudWatch. | bool | null | yes |
  | cloudwatch_log_group_class | Clase del grupo de logs en CloudWatch. | string | null | yes |
  | license_model | Modelo de licencia para bases de datos. | string | null | yes |
  | timezone | Zona horaria para bases de datos SQL Server. | string | null | yes |
  | replicate_source_db | Nombre de la instancia de origen para la replicaci√≥n. | string | null | yes |
  | replica_mode | Modo de r√©plica para la instancia de base de datos. | string | null | yes |
  | character_set_name | Nombre del conjunto de caracteres de la base de datos. | string | null | yes |
  | nchar_character_set_name | Nombre del conjunto de caracteres NCHAR de la base de datos. | string | null | yes |
  | s3_import | Configuraci√≥n de importaci√≥n de datos desde S3 para MySQL. | string | null | yes |
  | db_instance_role_associations | Asociaciones de roles de instancia de base de datos (por ejemplo, IAM). | map | {} | no |
